---
import store from "@/store/index";
import BaseLayout from "@/layouts/BaseLayout.astro";
import Sections from "@/components/poc/Sections.js";

// Get the home page content
const session = store.openSession();
const home = await session
  .query({ indexName: "Content/ByUrl" })
  .whereEquals("url", Astro.url.pathname)
  .firstOrNull();

if(home.sections.some((section) => section["@strife"].template === "nyheter")) {
  const news = await session.advanced.rawQuery(
    home.sections.find((section) => section["@strife"].template === "nyheter").content.query
  ).all();
  home.sections.find((section) => section["@strife"].template === "nyheter").content.documents = news;
}
---

<BaseLayout>
  <Sections sections={home.sections} client:load />
</BaseLayout>
